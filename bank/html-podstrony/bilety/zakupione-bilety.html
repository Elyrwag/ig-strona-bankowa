<link href="css/bilety/bilet-wspolne.css" type="text/css" rel="stylesheet">
<link href="css/bilety/zakupione-bilety.css" type="text/css" rel="stylesheet">

<!-- Główna zawartość strony -->
<div id="content">
    <div id="pop-up-window" class="pop-up">
        <div id="pop-up-content-window" class="pop-up-content h-30-percent">
            <span id="close-pop-up-button" class="close-pop-up">&times;</span>
            <span id="pop-up-header">Szczegóły</span>
            <span id="pop-up-text">Lorem Ipsum...</span>
        </div>
    </div>

    <div id="ticket-information" class="homepage-section">

        <div id="button-container">
            <button id="return-button" class="blue-button" type="button">Powrót</button>
            <button id="buy-button" class="blue-button" type="button">Kup bilet</button>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
    function boughtTicketsInit() {
        const ticketInformation = document.getElementById('ticket-information');
        const button = document.getElementById('button-container')

        expMap = new Map(
            [['MPK - ulgowy, 1 miesiąc', 30],
                ['MPK - ulgowy, 2 miesiące', 60],
                ['MPK - ulgowy, 3 miesiące', 90],
                ['MPK - normalny, 1 miesiąc', 30],
                ['MPK - normalny, 2 miesiące', 60],
                ['MPK - normalny, 2 miesiące', 90],
                ['Park & Ride Kraków', 1],
                ['Autostrada A4  Kraków Katowice', 2],
                ['Autostrada A2  Konin Świecko', 2]]
        );

        let ticketsList = BankStorage.getTickets();

        ticketsList.forEach(ticket => {
            const ticketElement = document.createElement('div');
            ticketElement.classList.add('ticket-information-element');

            const leftColumn = document.createElement('div');
            leftColumn.classList.add('left-column');

            const ticketLeftColumnElement = document.createElement('div');
            ticketLeftColumnElement.classList.add('ticket-left-column-element');
            ticketLeftColumnElement.textContent = ticket.title;

            leftColumn.appendChild(ticketLeftColumnElement);

            const rightColumn = document.createElement('div');
            rightColumn.classList.add('right-column');

            const firstRow = document.createElement('div');
            firstRow.classList.add('first-row');

            const dateParts = ticket.date.split('.');
            const formattedDate = `${dateParts[2]}-${dateParts[1]}-${dateParts[0]}`;
            const d = new Date(formattedDate);
            const daysToAdd = expMap.get(ticket.title);
            d.setDate(d.getDate() + daysToAdd)
            const str = `${('0' + d.getDate()).slice(-2)}.${('0' + (d.getMonth() + 1)).slice(-2)}.${d.getFullYear()}`;

            firstRow.textContent = `Ważny do: ${str}`;

            const secondRow = document.createElement('div');
            secondRow.classList.add('second-row');

            const detailsElement = document.createElement('div');
            detailsElement.classList.add('second-row-element');
            detailsElement.setAttribute('id', 'details');
            detailsElement.textContent = 'Szczegóły';

            const printElement = document.createElement('div');
            printElement.classList.add('second-row-element');
            printElement.textContent = 'Drukuj';

            secondRow.appendChild(detailsElement);
            secondRow.appendChild(printElement);

            rightColumn.appendChild(firstRow);
            rightColumn.appendChild(secondRow);

            ticketElement.appendChild(leftColumn);
            ticketElement.appendChild(rightColumn);

            ticketInformation.insertBefore(ticketElement, button);
        });

        $('#return-button').click(() => {
            loadPage('Bilety', 'html-podstrony/bilety/bilety.html');
        });

        $('#buy-button').click(() => {
            loadPage('Oferta biletów', 'html-podstrony/bilety/oferta-biletow.html', () => {
                showDefaultTicketOfferContent();
            });
        });
    }

    if (document.readyState !== 'loading') {
        boughtTicketsInit();
    } else {
        document.addEventListener('DOMContentLoaded', function () {
            boughtTicketsInit();
        });
    }

    function ticketsInformations() {
        let modal = document.getElementById("pop-up-window");
        let btn = document.getElementById("details");
        let close = document.getElementById("close-pop-up-button");
        setupPopup(modal, btn, close);
    }

</script>
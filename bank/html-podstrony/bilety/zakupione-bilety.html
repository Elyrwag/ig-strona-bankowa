<link href="css/bilety/bilet-wspolne.css" type="text/css" rel="stylesheet">
<link href="css/bilety/zakupione-bilety.css" type="text/css" rel="stylesheet">

<!-- Główna zawartość strony -->
<div id="content">
    <div id="pop-up-window" class="pop-up">
        <div id="pop-up-content-window" class="pop-up-content h-unset pop-up-max-width">
            <span id="close-pop-up-button" class="close-pop-up">&times;</span>
            <div class="pop-up-header">Szczegóły</div>
            <hr>
            <div class="container pop-up-text">
                <div class="row row-cols-2">
                    <div class="col text-start">Rodzaj biletu:</div>
                    <div id="ticket-type-info" class="col text-end"></div>

                    <div class="col text-start">Posiadacz:</div>
                    <div class="col text-end">Jan Młynarz</div>

                    <div class="col text-start">Cena zakupu:</div>
                    <div id="ticket-amount-info" class="col text-end"></div>

                    <div class="col text-start">Data zakupu:</div>
                    <div id="purchase-date-info" class="col text-end"></div>

                    <div class="col text-start">Bilet ważny do:</div>
                    <div id="valid-to-info" class="col text-end"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="ticket-information" class="homepage-section">

        <div id="button-container">
            <button id="return-button" class="blue-button" type="button">Powrót</button>
            <button id="buy-button" class="blue-button" type="button">Kup bilet</button>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
    function boughtTicketsInit() {
        const ticketInformation = document.getElementById('ticket-information');
        const button = document.getElementById('button-container')

        let expMap = new Map(
            [['MPK - ulgowy, 1 miesiąc', 30],
                ['MPK - ulgowy, 2 miesiące', 60],
                ['MPK - ulgowy, 3 miesiące', 90],
                ['MPK - normalny, 1 miesiąc', 30],
                ['MPK - normalny, 2 miesiące', 60],
                ['MPK - normalny, 3 miesiące', 90],
                ['Park & Ride Kraków', 1],
                ['Autostrada A4  Kraków Katowice', 2],
                ['Autostrada A2  Konin Świecko', 2]]
        );

        let ticketsList = BankStorage.getTickets();

        ticketsList.forEach(ticket => {
            const ticketElement = document.createElement('div');
            ticketElement.classList.add('ticket-information-element');

            const leftColumn = document.createElement('div');
            leftColumn.classList.add('left-column');

            const ticketLeftColumnElement = document.createElement('div');
            ticketLeftColumnElement.classList.add('ticket-left-column-element');
            ticketLeftColumnElement.textContent = ticket.title;

            leftColumn.appendChild(ticketLeftColumnElement);

            const rightColumn = document.createElement('div');
            rightColumn.classList.add('right-column');

            const firstRow = document.createElement('div');
            firstRow.classList.add('first-row');

            const dateParts = ticket.date.split('.');
            const formattedDate = `${dateParts[2]}-${dateParts[1]}-${dateParts[0]}`;
            const d = new Date(formattedDate);
            const daysToAdd = expMap.get(ticket.title);
            d.setDate(d.getDate() + daysToAdd)
            const str = `${('0' + d.getDate()).slice(-2)}.${('0' + (d.getMonth() + 1)).slice(-2)}.${d.getFullYear()}`;

            firstRow.textContent = `Ważny do: ${str}`;

            const secondRow = document.createElement('div');
            secondRow.classList.add('second-row');

            const detailsElement = document.createElement('div');
            detailsElement.classList.add('second-row-element', 'details');
            detailsElement.textContent = 'Szczegóły';

            const printElement = document.createElement('div');
            printElement.classList.add('second-row-element');
            printElement.textContent = 'Drukuj';

            secondRow.appendChild(detailsElement);
            secondRow.appendChild(printElement);

            rightColumn.appendChild(firstRow);
            rightColumn.appendChild(secondRow);

            ticketElement.appendChild(leftColumn);
            ticketElement.appendChild(rightColumn);

            ticketInformation.insertBefore(ticketElement, button);
        });

        $('#return-button').click(() => {
            loadPage('Bilety', 'html-podstrony/bilety/bilety.html');
        });

        $('#buy-button').click(() => {
            loadPage('Oferta biletów', 'html-podstrony/bilety/oferta-biletow.html', () => {
                showDefaultTicketOfferContent();
            });
        });
    }

    function updateTicketDetails(index) {
        let ticketsList = BankStorage.getTickets();
        let selectedTicket = ticketsList[index];

        let Date = document.querySelectorAll('.first-row')[index].textContent.split(':')[1].trim();

        document.getElementById('ticket-type-info').textContent = selectedTicket.title;
        document.getElementById('ticket-amount-info').textContent = selectedTicket.amount + ' zł';
        document.getElementById('purchase-date-info').textContent = selectedTicket.date;
        document.getElementById('valid-to-info').textContent = Date;

    }

    function ticketsInformations() {
        let modal = document.getElementById("pop-up-window");
        let close = document.getElementById("close-pop-up-button");
        let buttons = document.getElementsByClassName("details");
        for (let i = 0; i < buttons.length; i++) {
            setupPopup(modal,buttons[i],close);
            $(buttons[i]).click(function() {
                updateTicketDetails(i);
            });
        }
    }

</script>